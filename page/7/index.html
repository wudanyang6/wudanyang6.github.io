<!doctype html><html lang=zh dir=auto><head><meta name=generator content="Hugo 0.117.0"><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>少侠的站点</title><meta name=keywords content="少侠,Read,Write,吴丹阳"><meta name=description content="世界如此之大，相逢即是缘"><meta name=author content="少侠"><link rel=canonical href=https://wudanyang6.github.io/><link crossorigin=anonymous href=/assets/css/stylesheet.59d8c087f49b5ad5fec842cc5a16eca1cfde89bdd475725f5cea2aa1a92d7633.css integrity="sha256-WdjAh/SbWtX+yELMWhbsoc/eib3UdXJfXOoqoaktdjM=" rel="preload stylesheet" as=style><link rel=icon href="https://avatars.githubusercontent.com/u/8189540?v=4"><link rel=icon type=image/png sizes=16x16 href="https://avatars.githubusercontent.com/u/8189540?v=4"><link rel=icon type=image/png sizes=32x32 href="https://avatars.githubusercontent.com/u/8189540?v=4"><link rel=apple-touch-icon href="https://avatars.githubusercontent.com/u/8189540?v=4"><link rel=mask-icon href="https://avatars.githubusercontent.com/u/8189540?v=4"><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://wudanyang6.github.io/index.xml><link rel=alternate type=application/json href=https://wudanyang6.github.io/index.json><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="少侠的站点"><meta property="og:description" content="世界如此之大，相逢即是缘"><meta property="og:type" content="website"><meta property="og:url" content="https://wudanyang6.github.io/"><meta property="og:site_name" content="少侠的站点"><meta name=twitter:card content="summary"><meta name=twitter:title content="少侠的站点"><meta name=twitter:description content="世界如此之大，相逢即是缘"><script type=application/ld+json>{"@context":"https://schema.org","@type":"Organization","name":"少侠的站点","url":"https://wudanyang6.github.io/","description":"世界如此之大，相逢即是缘","thumbnailUrl":"https://avatars.githubusercontent.com/u/8189540?v=4","sameAs":["https://github.com/wudanyang6","https://wudanyang6.github.io/index.xml","https://www.cnblogs.com/wudanyang"]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://wudanyang6.github.io/ accesskey=h title="首页 (Alt + H)"><img src="https://avatars.githubusercontent.com/u/8189540?v=4" alt aria-label=logo height=35>首页</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://wudanyang6.github.io/tags/ title=标签><span>标签</span></a></li><li><a href=https://wudanyang6.github.io/search/ title="搜索 (Alt + /)" accesskey=/><span>搜索</span></a></li><li><a href=https://wudanyang6.github.io/archives/ title=时间轴><span>时间轴</span></a></li><li><a href=https://wudanyang6.github.io/about/ title=关于><span>关于</span></a></li><li><a href=https://wudanyang6.github.io/music/ title=音乐><span>音乐</span></a></li></ul></nav></header><main class=main><article class=post-entry><header class=entry-header><h2>树莓派 ubuntu 配置网络</h2></header><div class=entry-content><p>树莓派 ubuntu 配置网络 树莓派现在可以安装很多操作系统，其中 ubuntu 也提供了树莓派版本，因为对 ubuntu 更加熟悉，所以就往 SD 卡中烧录了 ubuntu 的 20.04 lts 64位 版本。这里有可供选择的操作系统。
简单提一嘴烧录操作系统到 SD 卡上面的方法，树莓派提供了一个傻瓜式的软件给大家使用，直接打开之后选择系统，就可以烧录了，烧录过程大概会有几分钟。
烧录完成之后，如果你按照树莓派官网的教程进行操作，肯定都行不通，因为树莓派的官方操作系统 Raspberry Pi OS 和 Ubuntu For Raspberry 上面的网络配置方式完全不一样。
安装了 ubuntu 的树莓派怎么配置网络？ 打开你烧录好的 SD 卡
找到 network-config 文件
写入如下配置：
wifis: wlan0: dhcp4: true optional: true access-points: &lt;wifi network name>: password: "&lt;wifi password>" 如果是企业网络：
wifis: wlan0: dhcp4: true optional: true access-points: &lt;wifi network name>: auth: key-management: eap method: peap identity: "wudanyang" password: "" 配置文件的格式...</p></div><footer class=entry-footer><span title='2021-04-28 10:18:04 +0800 +0800'>2021, 四月 28</span>&nbsp;·&nbsp;少侠</footer><a class=entry-link aria-label="post link to 树莓派 ubuntu 配置网络" href=https://wudanyang6.github.io/post/raspberry/ubuntu-network/></a></article><article class=post-entry><header class=entry-header><h2>如何调试nginx的rewrite规则?</h2></header><div class=entry-content><p>如何调试nginx的rewrite规则？ 设置 rewrite_log on;
并且将error_log 的报错等级改成 notice;
官网对 rewrite_log 的解释：
Syntax: rewrite_log on | off; Default: rewrite_log off; Context: http, server, location, if Enables or disables logging of ngx_http_rewrite_module module directives processing results into the error_log at the notice level. 可以看到，这个指令只能在 http server location if 配置指令中使用，日志等级是 notice 写入到 error_log 配置的文件中。
示例 url： /q?someparams
2021/04/22 18:21:28 [notice] 18131#0: *102982 "^/+m/question(.*)?qid=\d+(.*)?$" does not match ... ... 中间省略一些日志 2021/04/22 18:21:28 [notice] 18131#0: *102982 "^/+question/(\w+....</p></div><footer class=entry-footer><span title='2021-04-23 14:58:47 +0800 +0800'>2021, 四月 23</span>&nbsp;·&nbsp;少侠</footer><a class=entry-link aria-label="post link to 如何调试nginx的rewrite规则?" href=https://wudanyang6.github.io/post/nginx/how-debug-nginx-rewrite/></a></article><article class=post-entry><header class=entry-header><h2>Nginx Master 进程主流程</h2></header><div class=entry-content><p>nginx master 进程主流程 之前有说到 nginx 进程模型-整体架构，下面来看一下 nginx master 进程的主要工作
nginx 的入口 main 函数在 nginx.c 文件中
函数原型为：
int ngx_cdecl main(int argc, char *const *argv) 在这个函数中，master 做了一系列的初始化操作
最终在下面这个地方进入了主流程中：
//... if (ngx_process == NGX_PROCESS_SINGLE) { ngx_single_process_cycle(cycle); } else { ngx_master_process_cycle(cycle); } //... 因为我们主要看 master-worker 这种进程模型，所以进入 ngx_master_process_cycle
设置信号屏蔽字，防止创建子进程过程中被信号中断 // 先清空信号集 sigemptyset(&amp;set); sigaddset(&amp;set, SIGCHLD); sigaddset(&amp;set, SIGALRM); sigaddset(&amp;set, SIGIO); sigaddset(&amp;set, SIGINT); sigaddset(&amp;set, ngx_signal_value(NGX_RECONFIGURE_SIGNAL)); sigaddset(&amp;set, ngx_signal_value(NGX_REOPEN_SIGNAL)); sigaddset(&amp;set, ngx_signal_value(NGX_NOACCEPT_SIGNAL)); sigaddset(&amp;set, ngx_signal_value(NGX_TERMINATE_SIGNAL)); sigaddset(&amp;set, ngx_signal_value(NGX_SHUTDOWN_SIGNAL)); sigaddset(&amp;set, ngx_signal_value(NGX_CHANGEBIN_SIGNAL)); // 设置信号屏蔽字，将 set 中的信号设置为阻塞状态，防止创建worker 的过程中，被进来的信号打断 if (sigprocmask(SIG_BLOCK, &amp;set, NULL) == -1) { ngx_log_error(NGX_LOG_ALERT, cycle->log, ngx_errno, "sigprocmask() failed"); } // 将 set 清空 sigemptyset(&amp;set); 设置信号屏蔽字，防止在创建子进程的过程中被信号处理程序中断...</p></div><footer class=entry-footer><span title='2021-04-13 21:07:19 +0800 +0800'>2021, 四月 13</span>&nbsp;·&nbsp;少侠</footer><a class=entry-link aria-label="post link to Nginx Master 进程主流程" href=https://wudanyang6.github.io/post/nginx/nginx-master/></a></article><article class=post-entry><header class=entry-header><h2>文件描述符</h2></header><div class=entry-content><p>什么是文件描述符 对于内核而言，所有打开的文件都通过 文件描述符（file descriptor）引用。通常也写作 fd。
文件描述符是一个非负整数。
当打开一个现有文件或者创建一个新文件时，内核向进程返回一个 文件描述符。
文件描述符是跟 进程相关联的。
按照惯例，UNIX 系统将 fd 0 对应进程的标准输入， fd 1 对应进程的标准输出， fd 2 对应进程的标准错误。
系统调用中的文件描述符 UNIX 系统中，一切皆文件，所以一切资源都可以使用文件描述符进程引用。
以 open 系统调用为例
使用 man 2 open 查看系统 man 手册
NAME open, openat -- open or create a file for reading or writing SYNOPSIS #include &lt;fcntl.h> int open(const char *path, int oflag, ...); int openat(int fd, const char *path, int oflag, ...); DESCRIPTION The file name specified by path is opened for reading and/or writing, as specified by the argument oflag; the file descriptor is returned to the calling process....</p></div><footer class=entry-footer><span title='2021-04-13 11:25:18 +0800 +0800'>2021, 四月 13</span>&nbsp;·&nbsp;少侠</footer><a class=entry-link aria-label="post link to 文件描述符" href=https://wudanyang6.github.io/post/os/fd/></a></article><article class=post-entry><header class=entry-header><h2>如何追查线上问题</h2></header><div class=entry-content><p>原则 止损优先 不能先追查问题根源， 首先应该止损，不让问题进一步扩大，代码回滚、服务降级等都可以起到止损的效果。 对于止损有一个比较好的实践，新业务或者重构业务上线时，可以加一个 配置开关 控制是否启用逻辑，在发现有损时，可以及时关掉业务逻辑，比重新上线要快很多。
及时通告 在问题发生之后，要及时对处理问题的过程进行通告。特别是应对线上有损的问题时，更应该及时通告。在内部群中，简单描述一下问题与可能的原因，处理的进度。而在外部群里，可以只说一下处理的进度。如果有必要，可以将问题上诉到领导，如果还解决不了问题，可以逐级继续上诉。
追查问题的方法 逻辑方法: 先收集现象：业务报错、线上报错日志等 对紧急的问题来说，需要对线上业务、服务器等非常熟悉，才能迅速收集到有用的报错信息。 针对现象假设原因： 常见问题依据追查手册 其他问题保持思路开放，大胆假设 是否有损的判断： 根据现象假设出可能的原因，判断是否是有损的，如果是有损的问题，参考 止损优先 质疑所有数据： 各个数据、监控系统等的有效性也需要质疑，不能完全相信，需要小心求证 知识准备 对线上各种日志的熟悉，从日志中能看到具体的问题，比如 nginx 日志 php 日志等 对线上的各种配置更要做到心中有数 对细节的追查，每次都更细一些，这样才能获得更多的信息 计算机基本功，有时问题追查不下去，不是没有线索，而是追查到了一个未知的领域，没有相关的知识，无法追查 总结经验 成熟的方法落地成工具 对问题的追查形成文档 问题解决之后 如果问题解决之后，我们就不再跟进了，那么我们就沦为了解决问题的工具，问题也随之越来越多，解决不完。 那么，我们可以通过思考以下几点来提升自己
线上是否恢复了正常？（基本） 问题的原因是什么？（形成记录） 通过什么手段恢复的？（解决方案） 怎么可以避免下次再次出现问题？（防患未然） 除了此次出现的问题，会不会有其他的问题出现（举一反三） 出现此类问题是否是架构问题造成的？（根本原因）</p></div><footer class=entry-footer><span title='2021-04-12 12:26:32 +0800 +0800'>2021, 四月 12</span>&nbsp;·&nbsp;少侠</footer><a class=entry-link aria-label="post link to 如何追查线上问题" href=https://wudanyang6.github.io/post/exp/locate-online-error/></a></article><footer class=page-footer><nav class=pagination><a class=prev href=https://wudanyang6.github.io/page/6/>«&nbsp;上一页&nbsp;</a>
<a class=next href=https://wudanyang6.github.io/page/8/>下一页&nbsp;&nbsp;»</a></nav></footer></main><footer class=footer><span>&copy; 2023 <a href=https://wudanyang6.github.io/>少侠的站点</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script async src=https://analytics.umami.is/script.js data-website-id=991e47f1-cc75-4cdd-8e98-d9df76b10a5e></script>
<script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><div style=display:none><span id=busuanzi_container_site_pv>访问量&nbsp;-&nbsp;
<span id=busuanzi_value_site_pv></span>
</span>&nbsp;
<span id=busuanzi_container_site_uv>访客数&nbsp;-&nbsp;<span id=busuanzi_value_site_uv></span>人次</span>
<span id=busuanzi_container_page_pv>本文总阅读量<span id=busuanzi_value_page_pv></span>次</span></div><script>const parentElement=document.querySelector("#top > footer"),childSpanElement=document.createElement("span"),childAElement=document.createElement("a");childAElement.text="Umami 🖥️",childAElement.href="https://analytics.umami.is/share/UlkLuBPCAx4ucevx/%E5%90%B4%E4%B8%B9%E9%98%B3%E7%9A%84%E7%AB%99%E7%82%B9",childSpanElement.appendChild(childAElement),parentElement.prepend(childSpanElement)</script><script src=https://code.jquery.com/jquery-3.7.0.min.js integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.umd.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.css><script>$(document).ready(function(){Fancybox.bind("[data-fancybox]",{})})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>